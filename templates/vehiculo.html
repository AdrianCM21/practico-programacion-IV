{% extends "layaut.html" %}

{% block content %}
<header>
    <div class="container header-container">
        <div class="header-left">
            <h3>Vehiculo</h3>

            <form id="searchForm" method="get">
                <label for="matricula">Matricula:</label>
                <input type="text" id="matricula" name="matricula" onkeyup="searchVehicles()"><br><br>
            
                <label for="marca">Marca:</label>
                <input type="text" id="marca" name="marca" onkeyup="searchVehicles()"><br><br>
            
                <label for="modelo">Modelo:</label>
                <input type="text" id="modelo" name="modelo" onkeyup="searchVehicles()"><br><br>

                <label for="garaje">Garaje:</label>
                <input type="text" id="garaje" name="garaje" onkeyup="searchVehicles()"><br><br>
            </form>
            
            <div class="itemcontainer border-bottom">
            </div>
            <div class="btncontainer mt-3 p-2 align-items-center">
             <a href="/"><button class="btn btn-primary">Volver</button></a>
             <a href="/vehiculo/add"><button class="btn btn-primary">+</button></a>
                <h2>Lista de modelos</h2>
                <table id="vehiclesTable" class="table table-striped table-bordered">
                    <thead class="table-bordered">
                        <tr>
                            <th>Matricula</th>
                            <th>Marca</th>
                            <th>Modelo</th>
                            <th>Garaje</th>
                        </tr>
                    </thead>
                    
                </table>
                

            </div>                  


        </div>
        <div class="header-right">
            <div class="sq-box">
                <img src="/static/image/car.png" alt="">
            </div>
        </div>
    </div>
    <div class="sq-box2"></div>



</header>

<script>
    async function searchVehicles() {
        const matricula = document.getElementById('matricula').value;
        const marca = document.getElementById('marca').value;
        const modelo = document.getElementById('modelo').value;
        const garaje = document.getElementById('garaje').value;

        const response = await fetch(`/vehicles/?matricula=${matricula}&marca=${marca}&modelo=${modelo}&garaje=${garaje}`);
        const vehicles = await response.json();
        console.log(vehicles)
        const table = document.getElementById('vehiclesTable');
        table.innerHTML = `
            <tr>
                <th>Matricula</th>
                <th>Marca</th>
                <th>Modelo</th>
                <th>Garaje</th>
            </tr>
            ${vehicles.map(vehicle => `
                <tr>
                    <td>${vehicle.matricula}</td>
                    <td>${vehicle.brand.descMarca}</td>
                    <td>${vehicle.model.descModelo}</td>
                    <td>${vehicle.garajes.description}</td>
                </tr>
            `).join('')}
        `;
    }
</script>
{% endblock %}